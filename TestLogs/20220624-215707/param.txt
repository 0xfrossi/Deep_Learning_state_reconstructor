input_size = 340 #costante

#Scelti casulmente al momento.... da rivedere come prima modifica forse
hidden_size = 170
hidden_size2 = 85
code_size = 30

input_layer = Input(shape=(input_size,))
hidden_1 = Dense(hidden_size, activation='relu', kernel_initializer="he_uniform",kernel_regularizer=tf.keras.regularizers.L1(l1=1e-4) )(input_layer)
hidden_3 = Dense(hidden_size2, activation='relu', kernel_initializer="he_uniform",kernel_regularizer=tf.keras.regularizers.L1(l1=1e-4) )(hidden_1)

code = Dense(code_size, activation='relu',kernel_initializer="he_uniform",kernel_regularizer=tf.keras.regularizers.L1(l1=1e-5))(hidden_3)
hidden_2 =Dense(hidden_size2, activation='relu',kernel_initializer="he_uniform",kernel_regularizer=tf.keras.regularizers.L1(l1=1e-4))(code)
hidden_4 =Dense(hidden_size, activation='relu',kernel_initializer="he_uniform",kernel_regularizer=tf.keras.regularizers.L1(l1=1e-4))(hidden_2)

output_layer = Dense(input_size, activation='sigmoid')(hidden_4)

autoencoder = Model(input_layer, output_layer)
#variare learning_rate beta_1,beta_2, da fare per ultimo
#batch_size ???
autoencoder.compile(optimizer=tf.keras.optimizers.Adam(learning_rate=0.006), loss='binary_crossentropy',metrics=["accuracy","Precision","Recall"])
history=autoencoder.fit(x=train,y=train, epochs=2000,batch_size=3000, validation_data=(validation,validation), callbacks=my_callbacks,
                      )